--- libpng-1.2.9/scripts/makefile.gcmmx.orig	2006-04-17 00:49:57.995628250 +0200
+++ libpng-1.2.9/scripts/makefile.gcmmx	2006-04-17 01:12:02.910430250 +0200
@@ -24,8 +24,8 @@
 LIBSOMAJ=$(LIBNAME).so.$(PNGMAJ)
 LIBSOVER=$(LIBNAME).so.$(PNGVER)
 OLDSO=libpng.so
-OLDSOMAJ=libpng.so.0
-OLDSOVER=libpng.so.0.$(PNGMIN)
+OLDSOMAJ=libpng.so.3
+OLDSOVER=libpng.so.3.$(PNGMIN)
 
 # Utilities:
 CC = gcc
@@ -142,12 +142,10 @@
 $(LIBSOVER): $(OBJSDLL)
 	$(CC) -shared -Wl,-soname,$(LIBSOMAJ) \
 	-o $(LIBSOVER) \
-	$(OBJSDLL)
+	$(OBJSDLL) -lz -lm
 
-$(OLDSOVER): $(OBJSDLL)
-	$(CC) -shared -Wl,-soname,$(OLDSOMAJ) \
-	-o $(OLDSOVER) \
-	$(OBJSDLL)
+$(OLDSOVER): $(LIBSOVER)
+	$(LN_SF) $(LIBSOVER) $(OLDSOVER)
 
 pngtest: pngtest.o $(LIBSO)
 	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
@@ -190,9 +188,8 @@
 	-@$(RM_F) $(DL)/$(OLDSOMAJ)
 	-@$(RM_F) $(DL)/$(OLDSOVER)*
 	cp $(LIBSOVER) $(DL)
-	cp $(OLDSOVER) $(DL)
+	$(LN_SF) $(LIBSOVER) $(DL)/$(OLDSOVER)
 	chmod 755 $(DL)/$(LIBSOVER)
-	chmod 755 $(DL)/$(OLDSOVER)
 	(cd $(DL); \
 	$(LN_SF) $(OLDSOVER) $(OLDSOMAJ); \
 	$(LN_SF) $(OLDSOMAJ) $(OLDSO); \
--- libpng-1.2.9/scripts/makefile.linux.orig	2006-04-17 00:49:57.999628500 +0200
+++ libpng-1.2.9/scripts/makefile.linux	2006-04-17 01:12:01.098317000 +0200
@@ -14,8 +14,8 @@
 LIBSOMAJ=$(LIBNAME).so.$(PNGMAJ)
 LIBSOVER=$(LIBNAME).so.$(PNGVER)
 OLDSO=libpng.so
-OLDSOMAJ=libpng.so.0
-OLDSOVER=libpng.so.0.$(PNGMIN)
+OLDSOMAJ=libpng.so.3
+OLDSOVER=libpng.so.3.$(PNGMIN)
 
 # Utilities:
 AR_RC=ar rc
@@ -110,12 +110,10 @@
 	$(LN_SF) $(LIBSOVER) $(LIBSOMAJ)
 
 $(LIBSOVER): $(OBJSDLL)
-	$(CC) -shared -Wl,-soname,$(LIBSOMAJ) -o $(LIBSOVER) $(OBJSDLL)
+	$(CC) -shared -Wl,-soname,$(LIBSOMAJ) -o $(LIBSOVER) $(OBJSDLL) -lz -m
 
-$(OLDSOVER): $(OBJSDLL)
-	$(CC) -shared -Wl,-soname,$(OLDSOMAJ) \
-	-o $(OLDSOVER) \
-	$(OBJSDLL)
+$(OLDSOVER): $(LIBSOVER)
+	$(LN_SF) $(LIBSOVER) $(OLDSOVER)
 
 pngtest: pngtest.o $(LIBSO)
 	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
@@ -158,9 +156,8 @@
 	-@$(RM_F) $(DL)/$(OLDSOMAJ)
 	-@$(RM_F) $(DL)/$(OLDSOVER)*
 	cp $(LIBSOVER) $(DL)
-	cp $(OLDSOVER) $(DL)
+	$(LN_SF) $(LIBSOVER) $(DL)/$(OLDSOVER)
 	chmod 755 $(DL)/$(LIBSOVER)
-	chmod 755 $(DL)/$(OLDSOVER)
 	(cd $(DL); \
 	$(LN_SF) $(OLDSOVER) $(OLDSOMAJ); \
 	$(LN_SF) $(OLDSOMAJ) $(OLDSO); \
